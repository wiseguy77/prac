# ğŸ”¥ ìŠ¤í”„ë§ í”„ë¡œì íŠ¸ í…œí”Œë¦¿

ì´ í”„ë¡œì íŠ¸ëŠ” **ë‹¤ì–‘í•œ ìŠ¤í”„ë§ ê¸°ë°˜ í”„ë¡œì íŠ¸ì—ì„œ ê³µí†µìœ¼ë¡œ ì¬ì‚¬ìš© ê°€ëŠ¥í•œ í…œí”Œë¦¿ ë ˆí¼ëŸ°ìŠ¤**ë¥¼ ë§Œë“œëŠ” ê²ƒì„ ëª©í‘œë¡œ í•©ë‹ˆë‹¤. ì‹¤ë¬´ ì‹ ê·œ í”„ë¡œì íŠ¸ì—ì„œë„ í™œìš©í•  ìˆ˜ ìˆë„ë¡ ê¹”ë”í•˜ê³ 
ì™„ì„±ë„ ìˆëŠ” êµ¬ì¡°ë¥¼ ê°–ì¶˜ **ë…ë¦½í˜• ìŠ¤í”„ë§ í”„ë¡œì íŠ¸**ì…ë‹ˆë‹¤.

# ğŸ“š ëª©ì°¨

1. [í”„ë¡œì íŠ¸ ì†Œê°œ](#-í”„ë¡œì íŠ¸-ì†Œê°œ)
2. [ê¸°ìˆ  ìŠ¤íƒ](#-ê¸°ìˆ -ìŠ¤íƒ)
3. [í–¥í›„ ì˜ˆì • ì‘ì—…](#-í–¥í›„-ì˜ˆì •-ì‘ì—…)
4. [ì§„í–‰ ì¤‘ / ì™„ë£Œ ì‘ì—…](#-ì§„í–‰-ì¤‘--ì™„ë£Œ-ì‘ì—…)
    1) [ì‘ë‹µ ì¶”ìƒí™”(ì™„ë£Œ)](#1-ì‘ë‹µ-ì¶”ìƒí™”ì™„ë£Œ)
    2) [ë¡œê¹…(ì™„ë£Œ)](#2-ë¡œê¹…ì™„ë£Œ)
    3) [ë‹¨ê³„ë³„ ì¸ì¦(ì™„ë£Œ)](#3-ë‹¨ê³„ë³„-ì¸ì¦ì™„ë£Œ)
    4) [QueryDSL ì¶”ìƒí™”(ì™„ë£Œ)](#4-QueryDSL-ì¶”ìƒí™”ì™„ë£Œ)
5. [ë¼ì´ì„¼ìŠ¤](#-ë¼ì´ì„¼ìŠ¤)

---

# ğŸ“Œ í”„ë¡œì íŠ¸ ì†Œê°œ

- ë‹¤ì–‘í•œ ìŠ¤í”„ë§ ê¸°ë°˜ í”„ë¡œì íŠ¸ì—ì„œ ê³µí†µìœ¼ë¡œ ì¬ì‚¬ìš© ê°€ëŠ¥í•œ **í…œí”Œë¦¿ ë ˆí¼ëŸ°ìŠ¤** ë§Œë“¤ê¸°
- ì™¸ë¶€ ì‹œìŠ¤í…œ(DB, API ë“±)ì— ì˜ì¡´í•˜ì§€ ì•Šê³  ë™ì‘ ê°€ëŠ¥í•œ **ë…ë¦½í˜• ìŠ¤í”„ë§ í”„ë¡œì íŠ¸** êµ¬ì¶•
- ìƒˆ í”„ë¡œì íŠ¸ì— ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” **ê¹”ë”í•˜ê³  ì™„ì„±ë„ ìˆëŠ” êµ¬ì¡°** ì¡ê¸°

---

# ğŸ”§ ê¸°ìˆ  ìŠ¤íƒ

- ![Java](https://img.shields.io/badge/Java-17-orange?logo=java)
  ![Spring Boot](https://img.shields.io/badge/Spring%20Boot-3.4.4-brightgreen?logo=springboot)
  ![Spring Security](https://img.shields.io/badge/Spring%20Security-6.4.4-brightgreen?logo=springsecurity)
  ![Spring Data](https://img.shields.io/badge/Spring%20Data-3.4.4-brightgreen?logo=spring&logoColor=white)
  ![QueryDSL](https://img.shields.io/badge/QueryDSL-6.1.1-blue)
  ![H2 Database](https://img.shields.io/badge/H2%20DB-in--memory-lightgrey?logo=H2%20database)
  ![Redis](https://img.shields.io/badge/Redis-in--memory-red?logo=redis)
  ![Logback](https://img.shields.io/badge/Logback-1.5.18-pink)
  ![OpenApi](https://img.shields.io/badge/OpenApi-doc-purple?logo=openapiinitiative)
  ![Maven](https://img.shields.io/badge/Maven-build-blue?logo=apachemaven)
  ![License](https://img.shields.io/badge/license-MIT-green)
---

# ğŸŒ± í–¥í›„ ì˜ˆì • ì‘ì—…

- OAuth 2.0 ë¡œê·¸ì¸ ì¸ì¦ êµ¬í˜„ ë° êµ­ë‚´ ë²¤ë”ìš© OAuth ì»¤ìŠ¤í…€ ë“±ë¡ (ì˜ˆ: ë„¤ì´ë²„, ì¹´ì¹´ì˜¤)
- ë¡œê¹… ê³ ë„í™” : Marker, AsyncAppender ì ìš©
- í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„± : MockMvc + í†µí•© í…ŒìŠ¤íŠ¸
- ì¸ì¦ íë¦„ ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ ì‘ì„± ë° ë¬¸ì„œí™”
- ë‹¤êµ­ì–´ ì§€ì›(ë©”ì‹œì§€ ë¦¬ì†ŒìŠ¤)
- **dockerfile ì´ë¯¸ì§€ ìƒì„±ê³¼ docker-compose ì‹¤í–‰í™˜ê²½ êµ¬ì„±**

---

# ğŸŒŸ ì§„í–‰ ì¤‘ / ì™„ë£Œ ì‘ì—…

## 1. ì‘ë‹µ ì¶”ìƒí™”(ì™„ë£Œ)

<details>
<summary><span style="font-size:15px">ìì„¸íˆ</span></summary>

- CommonResponse ì‘ë‹µ ê°ì²´ ì •ì˜
- AOP-like GlobalResponseAdvice í•¸ë“¤ëŸ¬ êµ¬í˜„(ì™„ë£Œ)
- AOP-like GlobalExceptionAdvice í•¸ë“¤ëŸ¬ êµ¬í˜„(ì™„ë£Œ)
- ErrorCode ì •ì˜: í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ì—ëŸ¬ êµ¬ë¶„ ë° HttpStatus ë§¤í•‘

### ğŸ“„ GlobalResponseAdvice.java

```java

@Slf4j
@RestControllerAdvice
@RequiredArgsConstructor
public class GlobalResponseAdvice implements ResponseBodyAdvice<Object> {

  private final ObjectMapper objectMapper;

  @Override
  public boolean supports(MethodParameter returnType,
      Class<? extends HttpMessageConverter<?>> converterType) {

    String path = ((ServletRequestAttributes) RequestContextHolder.getRequestAttributes())
        .getRequest().getRequestURI();

    return !path.startsWith("/v3/api-docs") &&
        !path.startsWith("/swagger") &&
        !path.startsWith("/swagger-ui");
  }

  @Override
  public Object beforeBodyWrite(Object body, MethodParameter returnType,
      MediaType selectedContentType, Class<? extends HttpMessageConverter<?>> selectedConverterType,
      ServerHttpRequest request, ServerHttpResponse response) {

    if (body instanceof CommonResponse) {
      return body;
    }

    if (body instanceof String) {
      try {
        return objectMapper.writeValueAsString(CommonResponse.success(body));
      } catch (JsonProcessingException e) {
        throw new RuntimeException("ì‘ë‹µ ì§ë ¬í™” ì‹¤íŒ¨", e);
      }
    }

    return CommonResponse.success(body);
  }
}
```

### ğŸ“„ GlobalExceptionAdvice.java

```java

@Slf4j
@RestControllerAdvice
public class GlobalExceptionAdvice {

  @ExceptionHandler(PracException.class)
  public ResponseEntity<CommonResponse<?>> handleCustomException(PracException e) {

    log.error("[Exception] : ", e);

    return ResponseEntity
        .status(e.getErrorCode().getHttpStatus())
        .body(CommonResponse.fail(e.getErrorCode()));
  }

  @ExceptionHandler({
      NoResourceFoundException.class, HttpMessageNotReadableException.class,
      MethodArgumentNotValidException.class})
  public ResponseEntity<CommonResponse<?>> handleGenericException(Exception e) {

    log.error("[Exception] : ", e);
    ErrorCode errorCode = ErrorCode.BAD_REQUEST;

    if (e instanceof NoResourceFoundException) {
      errorCode = ErrorCode.NO_RESOURCE_FOUND;
    } else if (e instanceof HttpMessageNotReadableException
        || e instanceof MethodArgumentNotValidException) {
      errorCode = ErrorCode.INVALID_REQUEST_BODY;
    }

    return ResponseEntity
        .status(errorCode.getHttpStatus())
        .body(CommonResponse.fail(errorCode));
  }

  @ExceptionHandler(Exception.class)
  public ResponseEntity<CommonResponse<?>> handleGenericException(Exception e,
      HttpServletRequest request) {

    if (request.getRequestURI().startsWith("/v3/api-docs") ||
        request.getRequestURI().startsWith("/swagger") ||
        request.getRequestURI().startsWith("/swagger-ui")) {
      return null; // Spring ê¸°ë³¸ ì²˜ë¦¬ë¡œ ë„˜ê¸°ê¸°
    }

    log.error("[Exception] : ", e);

    return ResponseEntity
        .status(HttpStatus.INTERNAL_SERVER_ERROR)
        .body(CommonResponse.fail(ErrorCode.INTERNAL_SERVER_ERROR));
  }
}
```

</details>

## 2. ë¡œê¹…(ì™„ë£Œ)

<details>
<summary><span style="font-size:15px">ìì„¸íˆ</span></summary>

- logbackì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
- ìš”ì²­ë³„ë¡œ ë¡œê¹…ì— í•„ìš”í•œ ë°ì´í„°ë¥¼ ëŒ€ë¹„í•´ MDC(Mapped Diagnostic Context)ë¥¼ ì¤€ë¹„í•©ë‹ˆë‹¤.
- Thread Local MDC ë³´ì•ˆì„ ê°•í™”í•˜ê¸° ìœ„í•´ ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì— CleanUpFilterë¥¼ ì¶”ê°€í•´ ë¦¬ì…‹í•©ë‹ˆë‹¤.

### ğŸ“„ CleanUpFilter.java

```java

@Slf4j
public class CleanUpFilter extends OncePerRequestFilter {

  @Override
  protected void doFilterInternal(HttpServletRequest request,
      HttpServletResponse response,
      FilterChain filterChain) throws ServletException, IOException {
    try {
      String clientIp = AuditUtil.getClientIp(request);
      MDC.put(REQUEST_IP.getMdcKey(), clientIp);
// (ì„ íƒ) ìš”ì²­ ì „ ì²˜ë¦¬
      filterChain.doFilter(request, response);
    } finally {
      SecurityContextHolder.clearContext();
      MDC.clear();
      log.info("Clean up complete.");
    }
  }
}
```

</details>

## 3. ë‹¨ê³„ë³„ ì¸ì¦(ì™„ë£Œ)

<details>
<summary><span style="font-size:15px">ìì„¸íˆ</span></summary>

- ì¸ì¦ ë‹¨ê³„ë³„ Custom Providerì™€ Token êµ¬í˜„
- ë¡œê·¸ì¸(ID/PW): ê¸°ë³¸ì ì¸ ë¡œê·¸ì¸ ì¸ì¦ íë¦„ êµ¬í˜„, ì‚¬ìš©ìëŠ” IDì™€ ë¹„ë°€ë²ˆí˜¸ë¡œ ë¡œê·¸ì¸ ê¸°ëŠ¥
- OTP(2ì°¨ ì¸ì¦): ë‘ ë²ˆì§¸ ì¸ì¦ ë‹¨ê³„ë¡œ OTP ë°©ì‹ ì¶”ê°€, ë³´ì•ˆ ê°•í™”ë¥¼ ìœ„í•œ ê¸°ëŠ¥
- JWT ê¸°ë°˜ ì¸ì¦ íë¦„: JWTë¥¼ í™œìš©í•œ ì¸ì¦, í† í° ìƒì„± ë° ê´€ë¦¬ ê¸°ëŠ¥
- Redisë¥¼ í†µí•œ RefreshToken ë° OTP ì €ì¥/ê´€ë¦¬
- JWTì˜ RefreshTokenê³¼ OTPë¥¼ Redisì— ì €ì¥í•´ ì„¸ì…˜ ê´€ë¦¬ ë° ë¹ ë¥¸ ì¸ì¦ ì²˜ë¦¬ ê°€ëŠ¥
- ğŸ” ì¸ì¦ íë¦„ ê°œìš”

```plaintext
  1. [ì‚¬ìš©ì] â†’ ë¡œê·¸ì¸ ìš”ì²­ (ID/PW)
  2. [ì„œë²„] â†’ ì‚¬ìš©ì ì¸ì¦ (Member DB ì¡°íšŒ)
     â†³ ì¼ì¹˜í•˜ë©´ OTP ìƒì„± â†’ Redis ì €ì¥
  3. [ì„œë²„] â†’ OTP ë°œì†¡ (ì´ë©”ì¼, SMS ë“±)
  4. [ì‚¬ìš©ì] â†’ OTP ì…ë ¥
  5. [ì„œë²„] â†’ Redisì—ì„œ OTP ê²€ì¦
     â†³ ì„±ê³µ ì‹œ AccessToken + RefreshToken ìƒì„± â†’ Redis ì €ì¥
  6. [ì„œë²„] â†’ JWT ì‘ë‹µ (í—¤ë”ì— ì‹¤ì–´ ë°˜í™˜)
  7. ì´í›„ ìš”ì²­ë¶€í„°ëŠ” â†’ JWT AccessToken ì¸ì¦ í•„í„°ì—ì„œ ì²˜ë¦¬
```

### 1. **ID/PW ë¡œê·¸ì¸ (LoginFilter, LoginAuthToken & Provider)**

- ì‚¬ìš©ìê°€ **ID**ì™€ **ë¹„ë°€ë²ˆí˜¸**ë¥¼ ì…ë ¥í•˜ë©´ `LoginAuthProvider`ê°€ ì´ë¥¼ ì²˜ë¦¬í•˜ê³ , ì‚¬ìš©ì ì¸ì¦ì„ ì§„í–‰í•©ë‹ˆë‹¤.
- ë¡œê·¸ì¸ ì‹œ `LoginAuthToken` ê°ì²´ë¥¼ ìƒì„±í•˜ì—¬ `AuthenticationManager`ì—ê²Œ ì „ë‹¬í•˜ê³ , ì¸ì¦ì„ ì²˜ë¦¬í•œ í›„ ì‚¬ìš©ìë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
- ì¸ì¦ì´ ì™„ë£Œë˜ë©´ OtpClientProxyê°€ ë°œí–‰í•´ì¤€ OTP ì½”ë“œë¥¼ ì‘ë‹µì— í¬í•¨í•´ ì „ë‹¬í•©ë‹ˆë‹¤.

### 2. **OTP ì¸ì¦ (OtpFilter, OtpAuthToken & Provider)**

- **OTP ì¸ì¦**ì€ ê¸°ë³¸ì ì¸ ID/PW ì¸ì¦ í›„ ì¶”ê°€ì ìœ¼ë¡œ **ì¼íšŒìš© ë¹„ë°€ë²ˆí˜¸(OTP)**ë¥¼ ì…ë ¥ë°›ì•„ í™•ì¸í•˜ëŠ” ê³¼ì •ì…ë‹ˆë‹¤.
- OTP ì¸ì¦ì„ ë‹´ë‹¹í•˜ëŠ” `OtpAuthProvider`ëŠ” `OtpAuthToken` ê°ì²´ë¥¼ ì‚¬ìš©í•˜ì—¬ OTP ì½”ë“œì™€ DB í˜¹ì€ Redisì— ì €ì¥ëœ OTPë¥¼ ë¹„êµí•©ë‹ˆë‹¤.
- OTP ì¸ì¦ í›„ ìœ íš¨ì„± ê²€ì¦ì´ ì™„ë£Œë˜ë©´ , **JWT í† í°**ì„ ë°œê¸‰í•©ë‹ˆë‹¤.

### 3. **JWT ì¸ì¦ (JwtFilter, JwtAuthToken, JwtAuthProvider)**

- **JWT ì¸ì¦**ì€ ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ í›„ ë°œê¸‰ë°›ì€ JWT í† í°ì„ ì´ìš©í•˜ì—¬ ì¸ì¦ì„ ì§„í–‰í•©ë‹ˆë‹¤.
- í´ë¼ì´ì–¸íŠ¸ê°€ ì„œë²„ë¡œ ìš”ì²­ ì‹œ `Authorization` í—¤ë”ì— JWTë¥¼ í¬í•¨í•´ ë³´ëƒ…ë‹ˆë‹¤.
- `JwtAuthProvider`ëŠ” ì´ JWT í† í°ì˜ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ì§„í–‰í•˜ê³ , í† í°ì— í¬í•¨ëœ ì‚¬ìš©ì ì •ë³´ë¥¼ í†µí•´ `JwtAuthToken` ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
- JWTê°€ ìœ íš¨í•˜ë©´, ì‚¬ìš©ì ì •ë³´ë¥¼ í¬í•¨í•œ ì¸ì¦ ì •ë³´ë¥¼ Spring Security ì»¨í…ìŠ¤íŠ¸ì— ì €ì¥í•˜ì—¬ ì¸ì¦ ìƒíƒœë¥¼ ìœ ì§€í•©ë‹ˆë‹¤.
- ë³´ì•ˆì„ ìœ„í•´ JWT ì•”í˜¸í‚¤ëŠ” ì‚¬ìš©ìë³„ë¡œ ê´€ë¦¬í•©ë‹ˆë‹¤.

### 4. ì¸ì¦ ì˜ˆì™¸ ì²˜ë¦¬

- `CustomAccessDeniedHandler`ì™€ `CustomAuthenticationEntryPoint`ëŠ” **Spring Security**ì—ì„œ ë°œìƒí•˜ëŠ” ì¸ì¦ ê´€ë ¨
  ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•˜ëŠ” **í•¸ë“¤ëŸ¬**ë¡œ,
  ì‘ë‹µ ìƒíƒœì™€ ë©”ì‹œì§€ë¥¼ **ì¼ê´€ì„± ìˆê²Œ** ë°˜í™˜í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ê°€ ì ì ˆí•œ ì²˜ë¦¬ ë° í”¼ë“œë°±ì„ ë°›ì„ ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.
    - **ì¸ì¦ì´ í•„ìš”í•œ ë¦¬ì†ŒìŠ¤ ìš”ì²­**
      ì‚¬ìš©ìê°€ ì¸ì¦ì´ í•„ìš”í•œ ë¦¬ì†ŒìŠ¤ë¥¼ ìš”ì²­í•  ë•Œ, ì¸ì¦ë˜ì§€ ì•Šì•˜ë‹¤ë©´ `CustomAuthenticationEntryPoint`ê°€ í˜¸ì¶œë©ë‹ˆë‹¤.
        - **ìƒíƒœ ì½”ë“œ**: `401 Unauthorized`
        - **ì‘ë‹µ ë©”ì‹œì§€**: `CommonResponse.fail(ErrorCode.UNAUTHORIZED)`
    - **ì¸ì¦ì€ ë˜ì—ˆìœ¼ë‚˜ ê¶Œí•œ ë¶€ì¡±**
      ì‚¬ìš©ìê°€ ê¶Œí•œì´ ì—†ëŠ” ë¦¬ì†ŒìŠ¤ë¥¼ ìš”ì²­í•  ë•Œ, `CustomAccessDeniedHandler`ê°€ í˜¸ì¶œë©ë‹ˆë‹¤.
        - **ìƒíƒœ ì½”ë“œ**: `403 Forbidden`
        - **ì‘ë‹µ ë©”ì‹œì§€**: `CommonResponse.fail(ErrorCode.ACCESS_DENIED)`
- ì˜ˆì™¸ë¥¼ **ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆ**í•˜ì—¬, ì„¸ë¶€ì ì¸ **ì—ëŸ¬ ì½”ë“œ**ì™€ **HTTP ìƒíƒœ ì½”ë“œ**ë¥¼ ë™ì ìœ¼ë¡œ ì„¤ì •í•  ìˆ˜ ìˆì–´ **ìœ ì—°í•œ ì—ëŸ¬ ì²˜ë¦¬**ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.
  ì´ë¥¼ í†µí•´ ì¸ì¦ ë° ê¶Œí•œ ê´€ë ¨ ì˜ˆì™¸ ì²˜ë¦¬ ì‹œìŠ¤í…œì„ ê²¬ê³ í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    - `ErrorCode.UNAUTHORIZED`: ê¸°ë³¸ì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ì˜¤ë¥˜ ì½”ë“œ.
    - `HttpStatus.UNAUTHORIZED.value()`: ê¸°ë³¸ì ìœ¼ë¡œ ë°˜í™˜í•˜ëŠ” HTTP ìƒíƒœ ì½”ë“œ (401).
    - `PracAuthenticationException`: ì»¤ìŠ¤í…€ ì˜ˆì™¸ë¡œ, ì¸ì¦ ì‹¤íŒ¨ ì‹œ ë” ì„¸ë¶€ì ì¸ ì •ë³´ ì œê³µ.

### ğŸ§‘â€ğŸ’» 5. Code

#### 1. `CustomAccessDeniedHandler`

- **ëª©ì **
    - ì‚¬ìš©ìê°€ **ê¶Œí•œì´ ì—†ëŠ”** ë¦¬ì†ŒìŠ¤ë¥¼ ì ‘ê·¼í•˜ë ¤ í•  ë•Œ ë°œìƒí•˜ëŠ” `AccessDeniedException`ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.
- **ë™ì‘**
    - ê¸°ë³¸ì ìœ¼ë¡œ **403 Forbidden** ìƒíƒœ ì½”ë“œì™€ `CommonResponse`ë¥¼ í†µí•´ **ê¶Œí•œ ë¶€ì¡±** ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ JSON í˜•ì‹ìœ¼ë¡œ ë°˜í™˜í•©ë‹ˆë‹¤.
    - `AccessDeniedHandler`ì—ì„œ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ `AccessDeniedException`ì„ ìƒì†í•œ `PracAccessDeniedException`ì„
      ì •ì˜í•©ë‹ˆë‹¤.
    - `PracAccessDeniedException`ì´ ë°œìƒí•˜ë©´, ì»¤ìŠ¤í…€ ì—ëŸ¬ ì½”ë“œì™€ HTTP ìƒíƒœ ì½”ë“œë¥¼ **ë™ì ìœ¼ë¡œ** ë³€ê²½í•˜ì—¬ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ğŸ“„ CustomAccessDeniedHandler.java

```java

@Component
@RequiredArgsConstructor
public class CustomAccessDeniedHandler implements AccessDeniedHandler {

  private final ObjectMapper objectMapper;

  @Override
  public void handle(HttpServletRequest request, HttpServletResponse response,
      AccessDeniedException accessDeniedException) throws IOException {

    // ê¸°ë³¸ ê°’ ì„¤ì •
    ErrorCode errorCode = ErrorCode.ACCESS_DENIED;
    int status = HttpStatus.FORBIDDEN.value();

    // PracAccessDeniedException ì²˜ë¦¬
    if (accessDeniedException instanceof PracAccessDeniedException pracEx) {
      errorCode = pracEx.getErrorCode();
      status = pracEx.getHttpStatus().value();
    }

    // ì‘ë‹µ ì„¤ì •
    response.setStatus(status);
    response.setContentType(MediaType.APPLICATION_JSON_VALUE);
    response.setCharacterEncoding(StandardCharsets.UTF_8.name());

    // ì˜¤ë¥˜ ì‘ë‹µ ì‘ì„±
    CommonResponse<?> error = CommonResponse.fail(errorCode);
    response.getWriter().write(objectMapper.writeValueAsString(error));
  }
}
```

- `ErrorCode.ACCESS_DENIED`: ê¸°ë³¸ì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ì˜¤ë¥˜ ì½”ë“œ.
- `HttpStatus.FORBIDDEN.value()`: ê¸°ë³¸ì ìœ¼ë¡œ ë°˜í™˜í•˜ëŠ” HTTP ìƒíƒœ ì½”ë“œ (403).
- `PracAccessDeniedException`: ì»¤ìŠ¤í…€ ì˜ˆì™¸ë¡œ, ì¸ì¦ ì‹¤íŒ¨ ì‹œ ë” ì„¸ë¶€ì ì¸ ì •ë³´ ì œê³µ.
-
    - ë‘ í•¸ë“¤ëŸ¬ ëª¨ë‘ **ì»¤ìŠ¤í…€ ì˜ˆì™¸**(`PracAccessDeniedException`, `PracAuthenticationException`)ë¥¼ í™œìš©í•˜ì—¬ ê°ê¸° ë‹¤ë¥¸
      ìƒí™©ì— ëŒ€í•œ ì„¸ë°€í•œ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.
- ì˜ˆë¥¼ ë“¤ì–´, JWT í† í° ë§Œë£Œë‚˜ ì˜ëª»ëœ í† í°ì„ ì²˜ë¦¬í•  ë•Œ, `PracAuthenticationException`ì„ ë˜ì§€ê³ ,
  ì´ë¥¼ `CustomAuthenticationEntryPoint`ì—ì„œ ì²˜ë¦¬í•˜ì—¬ ìœ ì €ì—ê²Œ ì ì ˆí•œ ë©”ì‹œì§€ë¥¼ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### 2. `CustomAuthenticationEntryPoint`

- **ëª©ì **
    - ì¸ì¦ì´ í•„ìš”í•œ ë¦¬ì†ŒìŠ¤ë¥¼ ìš”ì²­í–ˆì§€ë§Œ, **ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ì**ê°€ ì ‘ê·¼í•  ë•Œ ë°œìƒí•˜ëŠ” `AuthenticationException`ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.
- **ë™ì‘**:
    - ê¸°ë³¸ì ìœ¼ë¡œ **401 Unauthorized** ìƒíƒœ ì½”ë“œë¥¼ ë°˜í™˜í•˜ë©°, `CommonResponse`ë¥¼ í†µí•´ **ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ì** ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ JSON í˜•ì‹ìœ¼ë¡œ
      ë°˜í™˜í•©ë‹ˆë‹¤.
    - `PracAuthenticationException`ì´ ë°œìƒí•˜ë©´, ì»¤ìŠ¤í…€ ì—ëŸ¬ ì½”ë“œì™€ HTTP ìƒíƒœ ì½”ë“œë¥¼ **ë™ì ìœ¼ë¡œ** ë³€ê²½í•˜ì—¬ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ğŸ“„ CustomAuthenticationEntryPoint.java

```java

@Component
@RequiredArgsConstructor
public class CustomAuthenticationEntryPoint implements AuthenticationEntryPoint {

  private final ObjectMapper objectMapper;

  @Override
  public void commence(HttpServletRequest request, HttpServletResponse response,
      AuthenticationException authException) throws IOException {

    // ê¸°ë³¸ ê°’ ì„¤ì •
    ErrorCode errorCode = ErrorCode.UNAUTHORIZED;
    int status = HttpStatus.UNAUTHORIZED.value();

    // PracAuthenticationException ì²˜ë¦¬
    if (authException instanceof PracAuthenticationException pracEx) {
      errorCode = pracEx.getErrorCode();
      status = pracEx.getHttpStatus().value();
    }

    // ì‘ë‹µ ì„¤ì •
    response.setStatus(status);
    response.setContentType(MediaType.APPLICATION_JSON_VALUE);
    response.setCharacterEncoding(StandardCharsets.UTF_8.name());

    // ì˜¤ë¥˜ ì‘ë‹µ ì‘ì„±
    CommonResponse<?> error = CommonResponse.fail(errorCode);
    response.getWriter().write(objectMapper.writeValueAsString(error));
  }
}
```

</details>

## 4. QueryDSL ì¶”ìƒí™”(ì™„ë£Œ)

<details>
<summary> <span style="font-size:15px">ìì„¸íˆ</span></summary>

### ğŸ¯ ëª©í‘œ

- **QueryDSL**ì„ ì‚¬ìš©í•˜ì—¬ ë³µì¡í•œ ì¿¼ë¦¬ì™€ ì •ë ¬ ë¡œì§ì„ **ì¶”ìƒí™”**í•˜ê³  ì»¤ìŠ¤í…€ ë ˆí¬ì§€í† ë¦¬ë¡œ ë¶„ë¦¬í•´ ì½”ë“œì˜ ì¬ì‚¬ìš©ì„±ì„ ë†’ì˜€ìŠµë‹ˆë‹¤.
- `QueryDSL`ì„ í™œìš©í•œ **ë™ì  ì¿¼ë¦¬ ì²˜ë¦¬** ë° **ì¡°ê±´ ê¸°ë°˜ í•„í„°ë§**ì„ êµ¬í˜„í•´ ë°˜ë³µì ì¸ ì¿¼ë¦¬ ì½”ë“œì˜ ì¤‘ë³µì„ ì—†ì•´ìŠµë‹ˆë‹¤.
- **ì»¤ìŠ¤í…€ ë ˆí¬ì§€í† ë¦¬**ë‚´ì—ì„œ ì„œë¹„ìŠ¤ ê³„ì¸µì—ì„œ í•„ìš”í•œ ë³µì¡í•œ ë°ì´í„° ê²€ìƒ‰ ë° ì²˜ë¦¬ ë¡œì§ì„ íš¨ìœ¨ì ì´ê³  ì¼ê´€ì„± ìˆê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.

### ğŸ› ï¸ êµ¬ì„±

- FieldFilter
    * ì£¼ì–´ì§„ í•„ë“œì— ëŒ€í•´ ì¡°ê±´ì„ ì¶”ê°€í•˜ëŠ” í•„í„°ì…ë‹ˆë‹¤.
- GroupFilter
    * ì—¬ëŸ¬ ì¡°ê±´ì„ ê·¸ë£¹í™”í•˜ì—¬ ì¡°ê±´ë“¤ì„ AND, OR ì§‘í•©ìœ¼ë¡œ ë‹¤ë£° ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- FieldResolver
    * ë³µì¡í•œ ì¡°ê±´ì„ í•´ì„í•˜ì—¬ ê²½ë¡œë¥¼ ì¶”ì í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.
- FieldResolverRegistry
    * íƒ€ì…ë³„ ë§¤ì¹˜ ì—°ì‚°ìë¥¼ ì•Œê³  ìˆëŠ” ë¦¬ì¡¸ë²„ë“¤ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.
    * ìš”ì²­í•œ ë°ì´í„°ì— ì í•©í•œ FieldResolver ì— ì¡°ê±´ì„ ì „ë‹¬í•©ë‹ˆë‹¤.
- SortResolver
    * ì •ë ¬ ì¡°ê±´ì„ ì²˜ë¦¬í•˜ëŠ” ê°ì²´ì…ë‹ˆë‹¤.
- SortResolverRegistry
    * íƒ€ì…ë³„ ì •ë ¬ ì—°ì‚°ìë¥¼ ì•Œê³  ìˆëŠ” ë¦¬ì¡¸ë²„ë“¤ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.
    * ìš”ì²­í•œ ë°ì´í„°ì— ì í•©í•œ SortResolver ì— ì¡°ê±´ì„ ì „ë‹¬í•©ë‹ˆë‹¤.
- CriteriaBuilder
    * ì¿¼ë¦¬ì™€ ì •ë ¬ì¡°ê±´ querydsl ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ê°ì²´ì…ë‹ˆë‹¤.
    * FieldResolverRegistryì™€ SortResolverRegistryì— ì•Œë§ì€ resolverë¥¼ íƒìƒ‰í•˜ê³  ê°ì²´ ìƒì„±ì„ ìš”ì²­í•©ë‹ˆë‹¤.

### ğŸ“„ QueryDslConfig.java - ë¦¬ì¡¸ë²„ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— íƒ€ì…ë³„ ë¦¬ì¡¸ë²„ë“¤ì„ ë“±ë¡

```java

@Configuration
public class QueryDslConfig {

  @PersistenceContext
  private EntityManager entityManager;

  @Bean
  public JPAQueryFactory jpaQueryFactory() {
    return new JPAQueryFactory(entityManager);
  }

  @Bean
  CriteriaBuilder genericPredicateBuilder() {

    FieldResolverRegistry fieldResolverRegistry = new FieldResolverRegistry();

    fieldResolverRegistry.register(String.class, new StringFieldResolver());
    fieldResolverRegistry.register(Integer.class, new IntegerFieldResolver());
    fieldResolverRegistry.register(Long.class, new LongFieldResolver());
    fieldResolverRegistry.register(BigDecimal.class, new BigDecimalFieldResolver());
    fieldResolverRegistry.register(Date.class, new DateFieldResolver());
    fieldResolverRegistry.register(LocalDateTime.class, new LocalDateTimeFieldResolver());

    SortResolverRegistry sortResolverRegistry = new SortResolverRegistry();

    sortResolverRegistry.register(String.class, new StringSortResolver());
    sortResolverRegistry.register(Integer.class, new IntegerSortResolver());
    sortResolverRegistry.register(Long.class, new LongSortResolver());
    sortResolverRegistry.register(BigDecimal.class, new BigDecimalSortResolver());
    sortResolverRegistry.register(Date.class, new DateSortResolver());
    sortResolverRegistry.register(LocalDateTime.class, new LocalDateTimeSortResolver());

    return new CriteriaBuilder(fieldResolverRegistry, sortResolverRegistry);
  }
}
```

### ğŸ“„ IntegerFieldResolver.java - íƒ€ì…ë³„ í•„ë“œ ë¦¬ì¡¸ë²„ ì˜ˆ

```java
public class IntegerFieldResolver implements FieldResolver<Integer> {

  private static final Map<MatchType, BiFunction<NumberPath<Integer>, Integer, BooleanExpression>> ops = new EnumMap<>(
      MatchType.class);

  static {
    ops.put(MatchType.EQUALS, SimpleExpression::eq);
    ops.put(MatchType.GREATER_THAN, NumberExpression::gt);
    ops.put(MatchType.LESS_THAN, NumberExpression::lt);
    ops.put(MatchType.GREATER_OR_EQUAL, NumberExpression::goe);
    ops.put(MatchType.LESS_OR_EQUAL, NumberExpression::loe);
  }

  @Override
  public BooleanExpression resolve(Path<Integer> path, Integer value, MatchType matchType) {

    if (!(path instanceof NumberPath<Integer> numberPath)) {
      throw new PracException(ILLEGAL_ARGUMENTS);
    }

    return ops.getOrDefault(matchType, SimpleExpression::eq)
        .apply(numberPath, value);
  }

  @Override
  public <E> BooleanExpression resolve(Class<E> entityClass, String alias,
      FieldFilter<?> fieldFilter) {

    PathBuilder<E> builder = new PathBuilder<>(entityClass, alias);
    NumberPath<Integer> path = builder.getNumber(fieldFilter.getField(), Integer.class);

    if (!(fieldFilter.getValue() instanceof Integer value)) {
      throw new PracException(ILLEGAL_ARGUMENTS);
    }

    return ops.getOrDefault(fieldFilter.getMatchType(), NumberPath::eq).apply(path, value);
  }
}
```

### ğŸ“„ IntegerSortResolver.java - íƒ€ì…ë³„ ì†ŒíŠ¸ ë¦¬ì¡¸ë²„ ì˜ˆ

```java
public class IntegerSortResolver implements SortResolver<Integer> {

  @Override
  public OrderSpecifier<?> resolve(PathBuilder<?> builder, String fieldName,
      Sort.Direction direction) {
    NumberPath<Integer> path = builder.getNumber(fieldName, Integer.class);
    return new OrderSpecifier<>(direction.isAscending() ? Order.ASC : Order.DESC, path);
  }
}
```

---

### ğŸ“„ MemberRepositoryCustom.java - ê²€ìƒ‰ ë° ì •ë ¬ ì¡°ê±´ë“¤ì„ ì¼ê´€ì„± ìˆê²Œ ì‚¬ìš©

```java
public interface MemberRepositoryCustom {

  List<Member> findMembersByPredicate(MemberSearchCondition condition);
}

public class MemberRepositoryImpl implements MemberRepositoryCustom {

  @PersistenceContext
  private EntityManager em;

  @Override
  public List<Member> filterMemberList(GroupFilterDto groupFilter) {

    String alias = "member_filter";
    QMember fMember = new QMember(alias);
    BooleanBuilder builder = new BooleanBuilder();

    // TODO : domain ì •ë³´ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•„í„°ë¥¼ ìƒì„±í•  ìˆ˜ ìˆë„ë¡ êµ¬í˜„
    Filter filter = groupFilter.getGroupFilter();
    criteriaBuilder.buildGroupFilter(Member.class, alias, filter);

    return jpaQuery.selectFrom(fMember)
        .where(builder)
        .fetch();
  }

  @Override
  public Page<MemberVo> pagingMemberList(GroupFilterDto groupFilterDto, Pageable pageable) {

    String alias = "member_filter";
    QMember fMember = new QMember(alias);
    BooleanBuilder builder = new BooleanBuilder();

    // TODO : domain ì •ë³´ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•„í„°ë¥¼ ìƒì„±í•  ìˆ˜ ìˆë„ë¡ êµ¬í˜„
    Filter filter = groupFilterDto.getGroupFilter();
    builder.and(criteriaBuilder.buildGroupFilter(Member.class, alias, filter));

    List<OrderSpecifier<?>> orderSpecifiers = new ArrayList<>();
    if (pageable.getSort().isSorted()) {
      for (Sort.Order order : pageable.getSort()) {
        orderSpecifiers.add(criteriaBuilder.buildSort(Member.class, alias, order));
      }
    }

    JPAQuery<Member> query = jpaQuery.selectFrom(fMember)
        .where(builder)
        .orderBy(orderSpecifiers.toArray(new OrderSpecifier[0]))
        .offset(pageable.getOffset())
        .limit(pageable.getPageSize());

    long total = query.fetchCount();

    List<MemberVo> members = query.fetch().stream().map(MemberVo::new).toList();

    return new PageImpl<>(members, pageable, total);
  }
}
```

</details>

---

# ğŸ“„ ë¼ì´ì„¼ìŠ¤

ì´ í”„ë¡œì íŠ¸ëŠ” MIT ë¼ì´ì„¼ìŠ¤ì— ë”°ë¼ ë°°í¬ë©ë‹ˆë‹¤.